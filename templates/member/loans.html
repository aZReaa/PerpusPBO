{% extends "member/base.html" %}

{% block title %}Peminjaman Saya - Perpustakaan Sekolah{% endblock %}

{% block extra_css %}
<style>    .loans-header-member {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        background-color: var(--white-bg);
        padding: 20px;
        border-radius: var(--border-radius-md);
        box-shadow: var(--card-shadow);
        flex-wrap: wrap;
        gap: 15px;
    }
    .loans-header-member h1 {
        color: var(--primary-blue);
        font-size: 1.8rem;
        margin: 0;
    }
    
    /* Mobile loans header */
    @media (max-width: 768px) {
        .loans-header-member {
            flex-direction: column;
            text-align: center;
            padding: 15px;
        }
        .loans-header-member h1 {
            font-size: 1.5rem;
        }
    }
    
    @media (max-width: 480px) {
        .loans-header-member {
            padding: 12px;
        }
        .loans-header-member h1 {
            font-size: 1.3rem;
        }
    }    .loans-table-container-member {
        background-color: var(--white-bg);
        padding: 25px;
        border-radius: var(--border-radius-md);
        box-shadow: var(--card-shadow);
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
        /* Better mobile scrolling */
        scrollbar-width: thin;
        scrollbar-color: var(--primary-blue) var(--light-blue-bg);
        width: 100%;
        display: block;
        position: relative;
        max-width: 100%;
    }
    
    /* WebKit scrollbar styling */
    .loans-table-container-member::-webkit-scrollbar {
        height: 8px;
    }
    
    .loans-table-container-member::-webkit-scrollbar-track {
        background: var(--light-blue-bg);
        border-radius: 4px;
    }
    
    .loans-table-container-member::-webkit-scrollbar-thumb {
        background: var(--primary-blue);
        border-radius: 4px;
    }
    
    .loans-table-container-member::-webkit-scrollbar-thumb:hover {
        background: var(--primary-blue-dark);
    }
    
    /* Mobile table container */
    @media (max-width: 768px) {
        .loans-table-container-member {
            padding: 20px;
        }
    }
    
    @media (max-width: 480px) {
        .loans-table-container-member {
            padding: 15px;
            border-radius: 6px;
        }
    }
    
    .loans-list-table {
        width: 100%;
        min-width: 700px;
        border-collapse: collapse;
    }
    .loans-list-table th, .loans-list-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #EAEAEA;
        font-size: 0.95rem;
        vertical-align: middle;
    }
    .loans-list-table thead th {
        background-color: var(--light-blue-bg);
        font-weight: 600;
        color: var(--primary-blue);
        font-size: 0.9rem;
        white-space: nowrap;
        position: sticky;
        top: 0;
        z-index: 10;
    }
    
    /* Mobile table adjustments */
    @media (max-width: 768px) {
        .loans-list-table {
            min-width: 600px;
        }
        .loans-list-table th, .loans-list-table td {
            padding: 8px 6px;
            font-size: 0.85rem;
        }
        .loans-list-table thead th {
            font-size: 0.8rem;
        }
        
        /* Hide less important columns on mobile */
        .loans-list-table th:nth-child(3),
        .loans-list-table td:nth-child(3),
        .loans-list-table th:nth-child(6),
        .loans-list-table td:nth-child(6) {
            display: none;
        }
    }
    
    @media (max-width: 480px) {
        /* Card-style layout for very small screens */
        .loans-list-table,
        .loans-list-table thead,
        .loans-list-table tbody,
        .loans-list-table th,
        .loans-list-table td,
        .loans-list-table tr {
            display: block;
        }
        
        .loans-list-table thead tr {
            position: absolute;
            top: -9999px;
            left: -9999px;
        }
        
        .loans-list-table tr {
            border: 1px solid #ddd;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            background: var(--white-bg);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .loans-list-table td {
            border: none;
            position: relative;
            padding: 8px 8px 8px 45%;
            text-align: left;
            white-space: normal;
        }
        
        .loans-list-table td:before {
            content: attr(data-label) ": ";
            position: absolute;
            left: 6px;
            width: 40%;
            padding-right: 10px;
            white-space: nowrap;
            font-weight: 600;
            color: var(--primary-blue);
            font-size: 0.8rem;
        }
        
        .loans-list-table {
            min-width: auto;
        }
    }    .book-title-cell {
        font-weight: 500;
        max-width: 200px;
    }
    .book-title-cell small {
        display: block;
        color: var(--text-light);
        font-size: 0.85rem;
        margin-top: 4px;
    }
    
    /* Mobile book title cell */
    @media (max-width: 768px) {
        .book-title-cell {
            max-width: 150px;
        }
        .book-title-cell small {
            font-size: 0.8rem;
        }
    }
    
    .loan-status-badge {
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 0.85rem;
        font-weight: 500;
        display: inline-block;
        white-space: nowrap;
    }
    .loan-status-badge.dipinjam {
        background-color: #DEEBFF;
        color: #0747A6;
    }
    .loan-status-badge.dikembalikan {
        background-color: #E6F7F0;
        color: #00875A;
    }
    
    /* Mobile status badge */
    @media (max-width: 480px) {
        .loan-status-badge {
            padding: 4px 8px;
            font-size: 0.8rem;
        }
    }
    
    .fine-amount-loan {
        color: #DE350B;
        font-weight: 500;
    }
    .date-cell.overdue {
        color: #DE350B;
        font-weight: 500;
    }
    .date-cell.due-today {
        color: #FF8B00;
        font-weight: 500;
    }    .no-loans-message {
        text-align: center;
        padding: 40px 20px;
        background-color: var(--white-bg);
        border-radius: var(--border-radius-md);
        box-shadow: var(--card-shadow);
    }
    .no-loans-message .icon {
        font-size: 3rem;
        color: var(--text-light);
        margin-bottom: 15px;
        display: block;
    }
    .no-loans-message h3 {
        margin-bottom: 10px;
        font-size: 1.3rem;
        color: var(--text-dark);
    }
    .no-loans-message p {
        color: var(--text-light);
        margin-bottom: 20px;
    }
    
    /* Mobile no loans message */
    @media (max-width: 768px) {
        .no-loans-message {
            padding: 30px 15px;
        }
        .no-loans-message .icon {
            font-size: 2.5rem;
        }
        .no-loans-message h3 {
            font-size: 1.2rem;
        }
    }
    
    @media (max-width: 480px) {
        .no-loans-message {
            padding: 20px 10px;
        }
        .no-loans-message .icon {
            font-size: 2rem;
        }
        .no-loans-message h3 {
            font-size: 1.1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="loans-header-member">
    <h1>ðŸ“– Peminjaman Saya</h1>
    <a href="{{ url_for('member_books') }}" class="btn-member">ðŸ“š Pinjam Buku Baru</a>
</div>

{% if loans %}
<div class="loans-table-container-member">
    <table class="loans-list-table">
        <thead>
            <tr>
                <th>Buku</th>
                <th>Tgl Pinjam</th>
                <th>Batas Kembali</th>
                <th>Tgl Kembali Aktual</th>
                <th>Status</th>
                <th>Denda</th>
            </tr>
        </thead>
        <tbody>            {% for loan in loans %}
            <tr>
                <td class="book-title-cell" data-label="Buku">
                    {{ loan.buku.judul }}
                    <small>{{ loan.buku.pengarang }}</small>
                </td>
                <td data-label="Tgl Pinjam">{{ loan.tanggal_pinjam.strftime('%d %b %Y') }}</td>
                <td class="date-cell 
                    {% if loan.status == 'dipinjam' and loan.tanggal_kembali_rencana.date() < today %}overdue{% endif %}
                    {% if loan.status == 'dipinjam' and loan.tanggal_kembali_rencana.date() == today %}due-today{% endif %}" data-label="Batas Kembali">
                    {{ loan.tanggal_kembali_rencana.strftime('%d %b %Y') }}
                </td>
                <td data-label="Tgl Kembali Aktual">
                    {% if loan.tanggal_kembali_aktual %}
                        {{ loan.tanggal_kembali_aktual.strftime('%d %b %Y') }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td data-label="Status">
                    {% if loan.status == 'dipinjam' %}
                        <span class="loan-status-badge dipinjam">Dipinjam</span>
                    {% elif loan.status == 'dikembalikan' %}
                        <span class="loan-status-badge dikembalikan">Dikembalikan</span>
                    {% else %}
                        <span class="loan-status-badge">{{ loan.status|capitalize }}</span>
                    {% endif %}
                </td>
                <td data-label="Denda">
                    {% if loan.denda > 0 %}
                        <span class="fine-amount-loan">Rp {{ "{:,.0f}".format(loan.denda).replace(",", ".") }}</span>
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="no-loans-message">
    <div class="icon">ðŸ“‚</div>
    <h3>Belum Ada Riwayat Peminjaman</h3>
    <p>Anda belum pernah meminjam buku. Mulai petualangan membaca Anda!</p>
    <a href="{{ url_for('member_books') }}" class="btn-member">Lihat Daftar Buku</a>
</div>
{% endif %}
{% endblock %}